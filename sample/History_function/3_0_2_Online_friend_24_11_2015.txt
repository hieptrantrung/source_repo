


Hi All,

Đầu command cho push status đã có trên staging rồi nhé.

Cmd: 150 

Params:

+ 4 bytes đầu length of status
+ n bytes tiếp theo là Status

============================================

Dear a Tú,

Đợt này mình sẽ thử nghiệm đưa lại list online friend cũ trở lại với tên mới (Ds mới cập nhật). Nguyên tắc hoạt động cơ bản vẫn như cũ nhưng có thêm privacy để có thể cho người khác xem trạng thái online của mình hay không

Các phần cần update như sau

1. Thêm privacy setting "OnlineFriends": default là giá trị ON: có nghĩa là xem dc ds các bạn đang online và người khác có thể xem của mình. Khi user đổi sang OFF thì đồng nghãi mình ko xem dc ds online của người khác và người khác ko xem được trạng thái của mình.

2. Mình sẽ sử dụng lại socket cmd 142 để trả về ds online (mới cập nhật) cho user với điều kiện check privacy liên quan.

3. Thêm thuộc tính điều khiển feature ở đầu Login

"settings":{
"features":{
"okHttp":0,
"suggested_sticker":0,
"Feed_location":0
"onlineFriend": 1; // 1: enable, 0: disable
},


=========================================

Dear all,

cmd 142 đã update lại rồi nhé . Để lấy dữ liệu theo chuẩn mới mọi người sử dụng subCMD = 1  

{
    "onlines": [{
        "id": 3492638,
        "status": "buon ngu"
    }, {
        "id": 69680371,
        "status": "Có ai biết ở Vũng Tàu khách sạn nào có phòng tập thể, gần biển và giá ok ko"
    }]
}

=============================
cmd 142

{"data":[73816860,142859907,103571143,101629599,102514125,1862786,100051415,146747598,114396404,114267192,111288019,72509484,101477603,69822717,102421615,69433882,100223562,100443291,70737083,69365025,70656026,69680371,110816022,72713887,69680609,109206776,69014434,73086824,71686474,100955833,106388236,107339900,100319729,106521598,100186596,101421082,70582909,22392553,100839318,4061436,100872758,69826951,70200360,69094242,149664,100055434,45386,72178644,73185613,72248198,19,68787684,70094911,69818444,100008397,74230862,73264082,69323750],"error_code":0,"error_message":"Successful."}

public final static long TIME_UPDATE_ONLINE_ZALO_FRIEND = 1 * 60 * 1000L;    // 1 minute in milliseconds

if (CoreUtility.currentUserUid != null
                    && !CoreUtility.currentUserUid.equals("")
                    && (System.currentTimeMillis() - ltUpdateOnlineList > GlobalData.TIME_UPDATE_ONLINE_ZALO_FRIEND)
                    && MainFragment.getInstance() != null
                    && (MainFragment.getInstance().getCurrentTab() == MainFragment.TabItem.PHONEBOOK)
                    && CoreUtils.isScreenOn()
                    && !Utils.isApplicationBroughtToBackground())
					
					
{"data":{"onlines":[{"status":"Với my team và khách mời :D","userId":73816860},{"status":"","userId":153790483},{"status":"","userId":101629599},{"status":"Hãy là chính mình rồi mọi việc cũng qua - không yếu lòng nữa - cố gắng - quyết tâm - không thay đổi - rồi sẽ làm được mà !!!!!!!","userId":102514125},{"status":"Alo","userId":1862786},{"status":"","userId":100051415},{"status":"","userId":146747598},{"status":"","userId":145077999},{"status":"Trời đã nóng lại còn cúp điện :WIPE","userId":114396404},{"status":"","userId":114267192},{"status":"\"Đầu óc nhỏ thì tâm hồn nhỏ. Tâm hồn nhỏ thì cuộc đời nhỏ. Cứ hát con cò bé bé xong ra đời cứ làm cò miết, cò đất, cò chứng khoán, cò hàng hóa...\"\n                                                -TNBS-","userId":104596595},{"status":"","userId":100476937},{"status":"","userId":100403789},{"status":"","userId":111288019},{"status":"","userId":72509484},{"status":"Chỉ một chữ \"nhẫn\" mà đôi khi phải học cả một đời. Từng này tuổi đầu, cũng gần nửa đoạn đường nhưng sao cảm thấy khó quá. Nên bây giờ hết nhịn nổi nữa roài","userId":124603574},{"status":"Truc giac cua minh hiem khi nao sai. Lan dau tien gap mat mot nguoi nao do, chi can vai cau xa giao la xac dinh cmnr ua hay k Ua, choi duoc hay k. Lan nay cung Vay, cho du da co gang nhieu lan de cai thien. Dac biet la cai the loai bnbnkbgob.","userId":123768048},{"status":"","userId":101477603},{"status":"","userId":69822717},{"status":"Từ giờ đừng ai nói câu cần e thương e nữa nhé.. Lừa đảo giả tạo ��","userId":102421615},{"status":"","userId":69433882},{"status":"Test","userId":100223562},{"status":"Trung thu trăng sáng như Gương ������","userId":100443291},{"status":"","userId":70737083},{"status":"","userId":69365025},{"status":"Test","userId":70656026},{"status":"","userId":69680371},{"status":"Everything is temporary. Love, Art, The earth, you, me ... especially me.","userId":110816022},{"status":"Be going to .......... :-((","userId":72713887},{"status":"","userId":69680609},{"status":"Nhieu khi e tu dung muon thet' len |-)","userId":580401},{"status":"","userId":108805176},{"status":"","userId":69014434},{"status":"http:\/\/mp3.zing.vn\/bai-hat\/Sao-Ta-Lang-Im-Ho-Ngoc-Ha\/ZWZAB606.html","userId":71686474},{"status":"I hate silent treatment!","userId":100955833},{"status":"","userId":106388236},{"status":"Sống mà ép phải làm cái kg thể thì buông tay cho nhau dc thanh thản.\nSống thực tế chút tốt hơn","userId":100319729},{"status":"Ai chơi Running Man ket ban nhé @@","userId":106521598},{"status":"","userId":100186596},{"status":"Mưa to vãi ;-X","userId":101421082},{"status":"...1M...","userId":70582909},{"status":"df","userId":22392553},{"status":"Khuyên tụi nhỏ đừng buồn nhưng bản thân sút mất 5kg\/tuần vì lo lắng :(","userId":73305514},{"status":"Cuối tuần mà hàng xóm sát vách tụ tập hát karaoke, lại còn hát dở. Đúng là không có cái khổ nào giống cái khổ nào","userId":2256848},{"status":"Chửi thề có đở stress ko nhỉ? Mình cần làm gì đó để giải toả mà ko để lại hậu quả nghiêm trọng ;!","userId":4061436},{"status":"Cởi trần rán cá thật là phê!","userId":100872758},{"status":"Việc ngập não","userId":23448267},{"status":"8-):((:((","userId":70138379},{"status":"Ở bên a e bình yên đến lạ . Xa a rùi e thấy lạ nhưng khá bình yên !!!","userId":69826951},{"status":"","userId":70200360},{"status":"","userId":69094242},{"status":"Có ai biết ở Vũng Tàu khách sạn nào có phòng tập thể, gần biển và giá ok ko","userId":149664},{"status":"Hôm nay vui toá :D","userId":45386},{"status":"Mèng ơi sao cái cửa nó cứ quay mòng mòng vậy ta :-f","userId":72178644},{"status":"","userId":73185613},{"status":"Hơi chán rồi...","userId":72248198},{"status":"1 chén cơm, 2 chén rau luộc, 3 chén canh ;f","userId":19},{"status":"Xui quá trời xui :--|:((:-((","userId":69335782},{"status":"Tomorrow will come","userId":68787684},{"status":"Trua nay nghe nhac Jimmy lam nho lai nhung ngay con tho au....","userId":100020684},{"status":"","userId":70094911},{"status":"Mùa đông là mùa ác mộng với mũi mình, ngồi làm mà ai cũng kêu về đi.","userId":69818444},{"status":"","userId":100008397},{"status":"Sáng đi làm bằng Innova, tối thì lết bộ về nhà. Lên voi xuống chó lẹ thiệt lẹ :'(","userId":74230862},{"status":"https:\/\/abc.xyz","userId":73264082},{"status":"","userId":155952},{"status":"7","userId":70098827},{"status":"","userId":69323750}],"status":["Đang bận","Chát không"]},"error_code":0,"error_message":"Successful."}

					
{"data":{"onlines":[{"status":"Với my team và khách mời :D","userId":73816860},{"status":"","userId":153790483},{"status":"Máy hết pin","userId":101629599},{"status":"Hãy là chính mình rồi mọi việc cũng qua - không yếu lòng nữa - cố gắng - quyết tâm - không thay đổi - rồi sẽ làm được mà !!!!!!!","userId":102514125},{"status":"Hi","userId":100051415},{"status":"","userId":120317682},{"status":"","userId":146747598},{"status":"","userId":100903698},{"status":"","userId":145077999},{"status":"Trời đã nóng lại còn cúp điện :WIPE","userId":114396404},{"status":"","userId":114267192},{"status":"\"Đầu óc nhỏ thì tâm hồn nhỏ. Tâm hồn nhỏ thì cuộc đời nhỏ. Cứ hát con cò bé bé xong ra đời cứ làm cò miết, cò đất, cò chứng khoán, cò hàng hóa...\"\n                                                -TNBS-","userId":104596595},{"status":"","userId":100403789},{"status":"","userId":111288019},{"status":"Con gái cưng tròn 23 tháng tuổi! Còn 1 tháng nữa là con đón sinh nhật lần thứ 2 rồi! Nhớ mới ngày nào còn vác con gái trong bụng giờ thì đi học rồi!","userId":20702532},{"status":"","userId":72509484},{"status":"","userId":101477603},{"status":"","userId":107995468},{"status":"","userId":69822717},{"status":"","userId":102421615},{"status":"","userId":69433882},{"status":"","userId":100223562},{"status":"Trung thu trăng sáng như Gương ������","userId":100443291},{"status":"","userId":70737083},{"status":"","userId":69365025},{"status":"","userId":70656026},{"status":"","userId":69680371},{"status":"Everything is temporary. Love, Art, The earth, you, me ... especially me.","userId":110816022},{"status":"","userId":100863804},{"status":"","userId":69680609},{"status":"Nhieu khi e tu dung muon thet' len |-)","userId":580401},{"status":"","userId":69014434},{"status":"","userId":73086824},{"status":"http:\/\/mp3.zing.vn\/bai-hat\/Sao-Ta-Lang-Im-Ho-Ngoc-Ha\/ZWZAB606.html","userId":71686474},{"status":"Lại dàn trận với anh Tào =))","userId":100955833},{"status":"","userId":106388236},{"status":"Một sớm thức dậy, ô cửa sổ xuyên qua ánh nắng\nNhìn quanh căn phòng, sao lạnh lùng cô đơn trống vắng\nChẳng có ai cười nói bên cạnh\nChỉ một mình anh ôm riêng anh","userId":107339900},{"status":"Sống mà ép phải làm cái kg thể thì buông tay cho nhau dc thanh thản.\nSống thực tế chút tốt hơn","userId":100319729},{"status":"Ai chơi Running Man ket ban nhé @@","userId":106521598},{"status":"","userId":100186596},{"status":"Mưa to vãi ;-X","userId":101421082},{"status":"...1M...","userId":70582909},{"status":"df","userId":22392553},{"status":"","userId":100839318},{"status":"Khuyên tụi nhỏ đừng buồn nhưng bản thân sút mất 5kg\/tuần vì lo lắng :(","userId":73305514},{"status":"Fan cuồng ngồi bên vỗ tay điên đảo ;P","userId":2256848},{"status":"Chửi thề có đở stress ko nhỉ? Mình cần làm gì đó để giải toả mà ko để lại hậu quả nghiêm trọng ;!","userId":4061436},{"status":"Cởi trần rán cá thật là phê!","userId":100872758},{"status":"8-):((:((","userId":70138379},{"status":"Ở bên a e bình yên đến lạ . Xa a rùi e thấy lạ nhưng khá bình yên !!!","userId":69826951},{"status":"","userId":70200360},{"status":"","userId":69094242},{"status":"Có ai biết ở Vũng Tàu khách sạn nào có phòng tập thể, gần biển và giá ok ko","userId":149664},{"status":"Hôm nay vui toá :D","userId":45386},{"status":"Mèng ơi sao cái cửa nó cứ quay mòng mòng vậy ta :-f","userId":72178644},{"status":"","userId":73185613},{"status":"Hơi chán rồi...","userId":72248198},{"status":"1 chén cơm, 2 chén rau luộc, 3 chén canh ;f","userId":19},{"status":"Xoá cảm nghĩ cũ - tại 182 Lê Đại Hành, phường 15, Quận 11, Ho Chi Minh City","userId":41117053},{"status":"Xui quá trời xui :--|:((:-((","userId":69335782},{"status":"Tomorrow will come","userId":68787684},{"status":"","userId":70094911},{"status":"Mùa đông là mùa ác mộng với mũi mình, ngồi làm mà ai cũng kêu về đi.","userId":69818444},{"status":"","userId":100008397},{"status":"","userId":155952},{"status":"7","userId":70098827},{"status":"","userId":69323750}],"status":["Tìm bạn chat","Rãnh quá","Bận ghê","Đừng làm phiền","Đang trên đường","Máy hết pin"]},"error_code":0,"error_message":"Successful."}					
					

					
					
{"data":{"is_set_setting":1,"privacy":{"view_feed":{"value":2,"id":3},"receive_birthday_notify":{"value":1,"id":14},"receive_message":{"value":1,"id":1},"view_photo":{"value":1,"id":2},"view_username":{"value":0,"id":6},"notify_detail_message":{"value":0,"id":9},"reply_sms_use_zalo":{"value":1,"id":10},"allow_comment":{"value":2,"id":4},"enable_room_wifi":{"value":0,"id":13},"view_birthday":{"value":2,"id":7},"online_status":{"value":2,"id":5},"display_seen_status":{"value":1,"id":11}},"mutes":{"group":[{"id":5849882,"start_time":1429160210,"duration":-1,"system_time":1429160211}],"chat":[]},"settings":{"vibrate_new_message":{"value":1,"id":7},"autoplay_voice":{"value":0,"id":1},"popup_unlock":{"value":1,"id":5},"auto_update_phonebook":{"value":0,"id":9},"show_popup_message":{"value":1,"id":4},"active_friend":{"value":1,"id":10},"notify_new_message":{"value":1,"id":8},"ringtone_new_message":{"value":1,"id":6},"language":{"value":0,"id":11},"use_enter_send_message":{"value":1,"id":3}}},"error_code":0,"error_message":"Successful."}
					

=====================================
25/11/2015
Cần thêm đk setting local (privacy)
if (SharedPreferencesData.getSettingShowOnlineFriends(MainApplication.getAppContext()) == GlobalData.ENABLE_ONLINE_FRIEND_FROM_SERVER)//off function for dev
{
	FriendManager.getInstance().updateOnlineList();
}					

Cần ko override ngược status vào lại
GlobalData.userInfo.stt


ZaloBusinessImpl.java
FeedOfflineManager.java
FindFriendFragmentActivity.java
UpdateOnlineStatusFragment.java
MyInfoActivity.java
ZaloListFragmentActivity.java

==============================================================

Hỏi product

1. Status cũng sẽ có độ dài tối đa, quy định từ server.

2. Chỉ khi user không có status mới thì mới sử dụng status cũ thay thế / Là sao, ví dụ trường hợp cụ thể

3. Với phiên bản mới: User chỉ có thể cập nhật status qua đường mới / Chỉ một đường ở tab danh bạ hay còn đường nào khác không

4. 	Status. Nếu không có status, canh giữa tên danh bạ theo chiều dọc / Trong file layout anh Cang đưa hiện status trong bubble giống hồi bản cũ và giống trong LBS, làm theo cái nào

==============================================================

Coding rule

1. thứ tự A-Z
For list zalo đã sort đúng thứ tự A-Z, check nếu tồn tại trong map ID - status sẽ add vào list, như thế đảm bảo sẽ đúng thứ tự, khác với phiên bản trước đó là for map Id- lấy ra user từ zalo list add vào

2. Layout default

Trong list danh bạ sẽ thêm 2 type item trả về là type label và type item update status
- Trong đó type label set bg = 0, nhấn vào k highlight và k làm gì
- Type item update status nhấn vào mở trang update status

3. Trong màn hình update status,
	Case 1: Chọn 1 status trong list để cập nhật, thấy loading và check hiển thị đúng vị trí, tắt mạng, chọn 
	Tạo ra hai pos show loading và pos hiển thị dấu check, adapter sẽ tùy theo pos nào mà show icon phù hợp, ưu tiên pos show loading
	Lưu lại onSaveInstance để test trường hợp don't keep activity
	
4. Test tính năng bật tắt setting privacy 15 updateSettingShowOnlineFriends
	- Trường hợp có network
	- Trường hợp k có network
	
5. Trường hợp cập nhật status thành công trong màn hình cập nhật status thì mới set result ok để khi back lại màn hình danh bạ thì update lại
	lưu biến current Status khi vừa vào màn hình cập nhật status, đến khi finish màn hình này thì check xem có sự thay đổi status với GlobalData.userInfo không, nếu có thay đổi thì set result OK, còn k thì thôi
	
6. Trong màn hình Update status, nếu status common rỗng do tắt setting show hide, gọi API lấy status

	lần đầu vào init list common, nếu list rỗng và setting show là OFF thì vẫn để loading và call API update LIst online	
	
7. Nếu gọi update status social, API thành công sẽ gọi đè vào GlobalData.userInfo.stt

private void setStateSuccess(FeedContent newFeed, JSONObject feedJson, String status)	trong FeedContent	

FeedOfflineManager.getInstance().saveNewGeneratedFeed(FeedContent.this.feedContentId, newFeed, feedJson, status); // insert new feed

8. bug action log, khi onitemclick cần gán biến onLineStatus để log được action khi click vào đối tượng nằm trong list online

9. 
	
	case UserInfoAdapter.UserSettingItem.SETTING_REMOVE_STATUS
	
	
	
	




	
	
	
	
	
	
	
	
	
	
	
	
	
==========================

1. Check setting bật tắt online friend từ server

if(!featuresJson.isNull("onlineFriend"))

{"okHttp":0,"suggested_sticker":0,"onlineFriend":1,"Feed_location":0}


2. Check get setting all từ đầu getAll setting trong UpdateMainThread

if(!privacy.isNull("online_friends")) 	

{"value":1,"id":15}

